@model IoTAssesment.ViewModels.DeviceFormViewModel
@{
    ViewData["Title"] = "Add New Device";
}

<!-- Header Section -->
<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 space-y-4 sm:space-y-0">
    <div>
        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
            <i class="fas fa-plus-circle text-blue-500 mr-3"></i>
            Add New IoT Device
        </h1>
        <p class="text-gray-600 mt-2">Configure your device settings and connect it to the system</p>
    </div>
    <a href="@Url.Action("Index")"
       class="group flex items-center px-6 py-3 border-2 border-gray-300 hover:border-gray-400 text-gray-700 hover:text-gray-900 font-semibold rounded-xl shadow hover:shadow-lg transition-all duration-200 transform hover:-translate-y-1 bg-white hover:bg-gray-50">
        <i class="fas fa-arrow-left mr-2 group-hover:scale-110 transition-transform duration-200"></i>
        Back to Device List
    </a>
</div>

<!-- Form Card -->
<div class="max-w-6xl mx-auto">
    <div class="bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-8 py-6">
            <h2 class="text-2xl font-bold text-white flex items-center">
                <i class="fas fa-microchip mr-3"></i>
                Device Information
            </h2>
            <p class="text-blue-100 mt-1">Fill in the details to register your new IoT device</p>
        </div>
        <div class="p-8">
            <form asp-action="Create" method="post" novalidate class="space-y-8">
                @Html.AntiForgeryToken()

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Basic Information Section -->
                    <div class="space-y-6">
                        <div class="border-l-4 border-blue-500 pl-4">
                            <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                Basic Information
                            </h3>
                            <p class="text-gray-600 text-sm mt-1">Essential details about your device</p>
                        </div>

                        <!-- Device Name -->
                        <div class="space-y-2">
                            <label asp-for="Device.Name" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-tag text-gray-400 mr-1"></i>
                                Device Name <span class="text-red-500">*</span>
                            </label>
                            <input asp-for="Device.Name"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 placeholder-gray-400"
                                   placeholder="Enter a descriptive device name" />
                            <span asp-validation-for="Device.Name" class="text-red-500 text-sm"></span>
                            <p class="text-gray-500 text-sm">
                                <i class="fas fa-lightbulb text-amber-400 mr-1"></i>
                                Use descriptive names like "Temperature Sensor - Lab A"
                            </p>
                        </div>

                        <!-- Device Type -->
                        <div class="space-y-2">
                            <label asp-for="Device.DeviceType" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-cogs text-gray-400 mr-1"></i>
                                Device Type <span class="text-red-500">*</span>
                            </label>
                            <select asp-for="Device.DeviceType"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white transition-all duration-200">
                                <option value="">-- Select Device Type --</option>
                                @foreach (var type in Model.AvailableDeviceTypes)
                                {
                                    <option value="@type">@type</option>
                                }
                            </select>
                            <span asp-validation-for="Device.DeviceType" class="text-red-500 text-sm"></span>
                        </div>

                        <!-- Location -->
                        <div class="space-y-2">
                            <label asp-for="Device.Location" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-map-marker-alt text-gray-400 mr-1"></i>
                                Location <span class="text-red-500">*</span>
                            </label>
                            <input asp-for="Device.Location"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 placeholder-gray-400"
                                   placeholder="e.g., Building A - Room 101" />
                            <span asp-validation-for="Device.Location" class="text-red-500 text-sm"></span>
                            <p class="text-gray-500 text-sm">
                                <i class="fas fa-info-circle text-blue-400 mr-1"></i>
                                Specify where this device is physically installed
                            </p>
                        </div>

                        <!-- Description -->
                        <div class="space-y-2">
                            <label asp-for="Device.Description" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-file-alt text-gray-400 mr-1"></i>
                                Description
                            </label>
                            <textarea asp-for="Device.Description"
                                      rows="4"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 placeholder-gray-400 resize-none"
                                      placeholder="Describe what this device monitors or controls..."></textarea>
                            <span asp-validation-for="Device.Description" class="text-red-500 text-sm"></span>
                        </div>
                    </div>

                    <!-- Technical Information Section -->
                    <div class="space-y-6">
                        <div class="border-l-4 border-purple-500 pl-4">
                            <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-microchip text-purple-500 mr-2"></i>
                                Technical Details
                            </h3>
                            <p class="text-gray-600 text-sm mt-1">Hardware and firmware information</p>
                        </div>

                        <!-- Serial Number -->
                        <div class="space-y-2">
                            <label asp-for="Device.SerialNumber" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-barcode text-gray-400 mr-1"></i>
                                Serial Number
                            </label>
                            <input asp-for="Device.SerialNumber"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 placeholder-gray-400"
                                   placeholder="e.g., SN-2024-001" />
                            <span asp-validation-for="Device.SerialNumber" class="text-red-500 text-sm"></span>
                        </div>

                        <!-- Firmware Version -->
                        <div class="space-y-2">
                            <label asp-for="Device.FirmwareVersion" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-code text-gray-400 mr-1"></i>
                                Firmware Version
                            </label>
                            <input asp-for="Device.FirmwareVersion"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 placeholder-gray-400"
                                   placeholder="e.g., 1.0.0" />
                            <span asp-validation-for="Device.FirmwareVersion" class="text-red-500 text-sm"></span>
                        </div>

                        <!-- Initial Status -->
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3 p-4 bg-green-50 border border-green-200 rounded-lg">
                                <div class="flex items-center">
                                    <input asp-for="Device.IsOnline"
                                           type="checkbox"
                                           class="w-5 h-5 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 focus:ring-2 transition-all duration-200" />
                                </div>
                                <div class="flex-1">
                                    <label asp-for="Device.IsOnline" class="flex items-center text-sm font-medium text-gray-900 cursor-pointer">
                                        <i class="fas fa-wifi text-green-600 mr-2"></i>
                                        Device is Currently Online
                                    </label>
                                    <p class="text-green-700 text-sm">
                                        Check this if the device is already connected and operational
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- MQTT Credentials Section -->
                        <div class="border-l-4 border-indigo-500 pl-4 mt-8">
                            <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-wifi text-indigo-500 mr-2"></i>
                                MQTT Connection
                            </h4>
                            <p class="text-gray-600 text-sm mt-1">Configure device communication settings</p>
                        </div>

                        <!-- Client ID -->
                        <div class="space-y-2">
                            <label asp-for="Device.ClientId" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-id-badge text-gray-400 mr-1"></i>
                                Client ID <span class="text-red-500">*</span>
                            </label>
                            <input asp-for="Device.ClientId"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 placeholder-gray-400"
                                   placeholder="e.g., device_temp_001" />
                            <span asp-validation-for="Device.ClientId" class="text-red-500 text-sm"></span>
                            <p class="text-gray-500 text-sm">
                                <i class="fas fa-info-circle text-indigo-400 mr-1"></i>
                                Unique identifier for MQTT communication
                            </p>
                        </div>

                        <!-- MQTT Username -->
                        <div class="space-y-2">
                            <label asp-for="Device.MqttUsername" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-user text-gray-400 mr-1"></i>
                                MQTT Username
                            </label>
                            <input asp-for="Device.MqttUsername"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 placeholder-gray-400"
                                   placeholder="Optional MQTT username" />
                            <span asp-validation-for="Device.MqttUsername" class="text-red-500 text-sm"></span>
                        </div>

                        <!-- MQTT Password -->
                        <div class="space-y-2">
                            <label asp-for="Device.MqttPassword" class="block text-sm font-medium text-gray-700">
                                <i class="fas fa-lock text-gray-400 mr-1"></i>
                                MQTT Password
                            </label>
                            <input asp-for="Device.MqttPassword"
                                   type="password"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 placeholder-gray-400"
                                   placeholder="Optional MQTT password" />
                            <span asp-validation-for="Device.MqttPassword" class="text-red-500 text-sm"></span>
                        </div>
                    </div>
                </div>

                <hr>
                <!-- Form Actions -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0 pt-6">
                    <div class="text-gray-600 text-sm">
                        <span class="text-red-500 font-bold">*</span> Required fields
                    </div>
                    <div class="flex flex-wrap gap-3">
                        <a href="@Url.Action("Index")" 
                           class="inline-flex items-center px-6 py-2.5 border-2 border-gray-300 hover:border-gray-400 text-gray-700 hover:text-gray-900 font-medium rounded-lg transition-all duration-200 bg-white hover:bg-gray-50">
                            <i class="fas fa-times mr-2"></i>
                            Cancel
                        </a>
                        <button type="submit" 
                                class="inline-flex items-center px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg">
                            <i class="fas fa-save mr-2"></i>
                            Create Device
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        // Auto-generate serial number if empty
        document.querySelector('[name="Device.DeviceType"]').addEventListener('change', function() {
            var deviceType = this.value;
            var serialField = document.querySelector('[name="Device.SerialNumber"]');

            if (deviceType && !serialField.value) {
                var prefix = deviceType.replace(/\s+/g, '').substring(0, 3).toUpperCase();
                var timestamp = Date.now().toString().slice(-6);
                serialField.value = prefix + '-' + timestamp;
                showToast('Serial number auto-generated', 'info');
            }
        });

        // Validate form before submission
        document.querySelector('form').addEventListener('submit', function(e) {
            var isValid = true;
            var requiredFields = ['Device.Name', 'Device.DeviceType', 'Device.Location', 'Device.ClientId'];

            requiredFields.forEach(function(field) {
                var element = document.querySelector('[name="' + field + '"]');
                var value = element ? element.value : '';
                if (!value || value.trim() === '') {
                    isValid = false;
                    if (element) {
                        element.classList.add('border-red-500', 'ring-2', 'ring-red-200');
                    }
                } else {
                    if (element) {
                        element.classList.remove('border-red-500', 'ring-2', 'ring-red-200');
                    }
                }
            });

            if (!isValid) {
                e.preventDefault();
                showToast('Please fill in all required fields before submitting.', 'error');
                return false;
            }
        });

        // Highlight changed fields
        document.querySelectorAll('input, select, textarea').forEach(function(element) {
            element.addEventListener('change', function() {
                this.classList.add('border-blue-400', 'ring-2', 'ring-blue-100');
            });
        });

        // Remove highlight on focus
        document.querySelectorAll('input, select, textarea').forEach(function(element) {
            element.addEventListener('focus', function() {
                this.classList.remove('border-red-500', 'ring-red-200');
            });
        });
    </script>
}